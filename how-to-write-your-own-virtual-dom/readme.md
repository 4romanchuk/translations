# –ö–∞–∫ –Ω–∞–ø–∏—Å–∞—Ç—å –≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π DOM
*–ü–µ—Ä–µ–≤–æ–¥ —Å—Ç–∞—Ç—å–∏ [deathmood](https://twitter.com/_deathmood) [How to write your own Virtual DOM](https://medium.com/@deathmood/how-to-write-your-own-virtual-dom-ee74acc13060)*

–ï—Å—Ç—å –¥–≤–µ –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–Ω–∞—Ç—å –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –≤–∞—à–µ–≥–æ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ DOM. –í–∞–º –¥–∞–∂–µ –Ω–µ –Ω—É–∂–Ω–æ –ø–æ–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ React –∏–ª–∏ –≤ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ DOM. –û–Ω–∏ —Ç–∞–∫–∏–µ –±–æ–ª—å—à–∏–µ –∏ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ, –Ω–æ –≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –æ—Å–Ω–æ–≤–Ω–∞—è —á–∞—Å—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ DOM –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω–∞ –º–µ–Ω—å—à–µ —á–µ–º –∑–∞ 50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞. 50. –°—Ç—Ä–æ–∫. –ö–æ–¥–∞. !!!

–ó–¥–µ—Å—å –∑–∞–ª–æ–∂–µ–Ω–æ –¥–≤–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π DOM - –ª—é–±–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ DOM
* –ö–æ–≥–¥–∞ –º—ã —á—Ç–æ-—Ç–æ –º–µ–Ω—è–µ–º –≤ –Ω–∞—à–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º DOM –¥–µ—Ä–µ–≤–µ, –º—ã —Å–æ–∑–¥–∞–µ–º –Ω–æ–≤–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –¥–µ—Ä–µ–≤–æ. –ê–ª–≥–æ—Ä–∏—Ç–º —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç —ç—Ç–∏ –¥–≤–∞ –¥–µ—Ä–µ–≤–∞ (—Å—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ), –Ω–∞—Ö–æ–¥–∏—Ç —Ä–∞–∑–Ω–∏—Ü—É –∏ –≤–Ω–æ—Å–∏—Ç —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π DOM, —á—Ç–æ–±—ã –æ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞–ª –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É.

–≠—Ç–æ –≤—Å–µ! –î–∞–≤–∞–π—Ç–µ —É–≥–ª—É–±–∏–º—Å—è –≤ –∫–∞–∂–¥—É—é –∏–∑ —ç—Ç–∏—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π.

## –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—à–µ–≥–æ DOM –¥–µ—Ä–µ–≤–∞
–•–æ—Ä–æ—à–æ, –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å –Ω–∞–º –Ω—É–∂–Ω–æ –∫–∞–∫-—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—à–µ DOM –¥–µ—Ä–µ–≤–æ –≤ –ø–∞–º—è—Ç–∏. –ò –º—ã –º–æ–∂–µ–º —Å–¥–µ–ª–∞—Ç—å —ç—Ç–æ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Å—Ç—ã—Ö JS –æ–±—ä–µ–∫—Ç–æ–≤. –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å –µ—Å—Ç—å —ç—Ç–æ –¥–µ—Ä–µ–≤–æ:

```html
<ul class="list">
    <li>item 1</li>
    <li>item 2</li>
</ul>
```

–í—ã–≥–ª—è–¥–∏—Ç –ø—Ä–æ—Å—Ç–æ, –Ω–µ —Ç–∞–∫ –ª–∏? –ö–∞–∫ –º—ã –º–æ–∂–µ–º —ç—Ç–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Å—Ç—ã—Ö JS –æ–±—ä–µ–∫—Ç–æ–≤:

```js
{
  type: 'ul', props: { 'class': 'list' }, children: [
    { type: 'li', props: {}, children: ['item 1'] },
    { type: 'li', props: {}, children: ['item 2'] }
  ]
}
```

–ó–¥–µ—Å—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–º–µ—Ç–∏—Ç—å –¥–≤–µ –≤–µ—â–∏:

* –ú—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ–º DOM —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –æ–±—ä–µ–∫—Ç–æ–º –≤–∏–¥–µ

```js
{ type: '‚Ä¶', props: { ‚Ä¶ }, children: [ ‚Ä¶ ] }
```

* –ú—ã –æ–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –Ω–æ–¥—ã –ø—Ä–æ—Å—Ç—ã–º–∏ JS —Å—Ç—Ä–æ–∫–∞–º–∏

–ù–æ –ø–∏—Å–∞—Ç—å –±–æ–ª—å—à–∏–µ –¥–µ—Ä–µ–≤—å—è —Ç–∞–∫–∏–º —Å–ø–æ—Å–æ–±–æ–º –¥–æ–≤–æ–ª—å–Ω–æ —Å–ª–æ–∂–Ω–æ. –¢–∞–∫ –¥–∞–≤–∞–π—Ç–µ –Ω–∞–ø–∏—à–µ–º –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, —á—Ç–æ–±—ã –Ω–∞–º —Å—Ç–∞–ª–æ –ø—Ä–æ—â–µ –ø–æ–Ω–∏–º–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É:

```js
function h(type, props, ‚Ä¶children) {
  return { type, props, children };
}
```

–¢–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –æ–ø–∏—Å—ã–≤–∞—Ç—å –Ω–∞—à–µ DOM –¥–µ—Ä–µ–≤–æ –≤ —Ç–∞–∫–æ–º –≤–∏–¥–µ:

```js
h('ul', { class: 'list' },
  h('li', {}, 'item 1'),
  h('li', {}, 'item 2'),
);
```

–í—ã–≥–ª—è–¥–∏—Ç –Ω–∞–º–Ω–æ–≥–æ —á–∏—â–µ, –Ω–µ –ø—Ä–∞–≤–¥–∞ –ª–∏? –ù–æ –º—ã –¥–∞–∂–µ –º–æ–∂–µ–º –ø–æ–π—Ç–∏ –¥–∞–ª—å—à–µ. –í—ã –≤–µ–¥—å —Å–ª—ã—à–∞–ª–∏ –ø—Ä–æ JSX, –Ω–µ —Ç–∞–∫ –ª–∏? –î–∞, —è —Ö–æ—Ç–µ–ª –±—ã –ø—Ä–∏–º–µ–Ω–∏—Ç—å –µ–≥–æ –∏–¥–µ–∏ —Ç—É—Ç. –¢–∞–∫ –∫–∞–∫ –∂–µ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç?

–ï—Å–ª–∏ –≤—ã —á–∏—Ç–∞–ª–∏ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Babel –∫ JSX [–∑–¥–µ—Å—å](https://babeljs.io/docs/plugins/transform-react-jsx/),
–≤—ã –∑–Ω–∞–µ—Ç–µ, —á—Ç–æ Babel —Ç—Ä–∞–Ω—Å–ø–∏–ª–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç –∫–æ–¥:

```html
<ul className=‚Äùlist‚Äù>
  <li>item 1</li>
  <li>item 2</li>
</ul>
```

–≤–æ —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ —ç—Ç–æ–≥–æ:

```js
React.createElement('ul', { className: 'list' },
  React.createElement('li', {}, 'item 1'),
  React.createElement('li', {}, 'item 2'),
);
```

–ó–∞–º–µ—Ç–∏–ª–∏ —Å—Ö–æ–¥—Å—Ç–≤–æ? –î–∞, –¥–∞... –ï—Å–ª–∏ –±—ã –º—ã —Ç–æ–ª—å–∫–æ –º–æ–≥–ª–∏ –ø—Ä–æ—Å—Ç–æ –∑–∞–º–µ–Ω–∏—Ç—å –≤—ã–∑–æ–≤ `React.createElement(...)` –Ω–∞ –Ω–∞—à `h(...)`... –û–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è, –º—ã –º–æ–∂–µ–º, –∏—Å–ø–æ–ª—å–∑—É—è jsx pragma. –ù–∞–º —Ç–æ–ª—å–∫–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Ö–æ–∂—É—é –Ω–∞ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —Å—Ç—Ä–æ—á–∫—É –≤ –Ω–∞—á–∞–ª–µ –Ω–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞ —Å –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º.

```html
/** @jsx helper */
<ul className=‚Äùlist‚Äù>
  <li>item 1</li>
  <li>item 2</li>
</ul>
```

–¢–∞–∫ –º—ã –∑–∞—Å—Ç–∞–≤–∏–º Babel –∑–∞–º–µ–Ω–∏—Ç—å `React.createElement` –Ω–∞ –Ω–∞—à `h`.

## –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞—à–µ–≥–æ DOM –¥–µ—Ä–µ–≤–∞

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –º—ã –∏–º–µ–µ–º DOM –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –≤ –æ–±—ã—á–Ω–æ–º JS –æ–±—ä–µ–∫—Ç–µ, –∏–º–µ—é—â–µ–º —Å–≤–æ—é —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –Ω–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ–∂–µ—Ç —Å—Ç—Ä–æ–∏—Ç—å –∏–∑ –Ω–µ–µ –Ω–∞—Å—Ç–æ—è—â–∏–π DOM.
–°–Ω–∞—á–∞–ª–∞ –¥–∞–≤–∞–π—Ç–µ —Å–¥–µ–ª–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è –∏ –≤–≤–µ–¥–µ–º —Ç–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—é:
* –ù–∞–∑–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ DOM —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ –±—É–¥—É—Ç –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å —Å–∏–º–≤–æ–ª–∞ ‚Äî $.
* Virtual DOM –±—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Å –∏–º–µ–Ω–µ–º node.
* –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ React –≤—Å–µ —É–∑–ª—ã –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ–≤–æ–º —ç–ª–µ–º–µ–Ω—Ç–µ

–¢–µ–ø–µ—Ä—å –Ω–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è –≤–µ—Ä–Ω–µ—Ç DOM —ç–ª–µ–º–µ–Ω—Ç, –ø–æ–∫–∞ –±–µ–∑ ¬´props¬ª –∏ ¬´children¬ª:
```
function createElement(node) {
  const isString = typeof node === 'string';
  return isString && document.createTextNode(node)
    || document.createElement(node.type);
}
```
–¢–∞–∫ –º—ã –º–æ–∂–µ–º —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã –∏ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ JS –æ–±—ä–µ–∫—Ç–æ–≤.
–¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤, –ø—Ä–∏ –ø–æ–º–æ—â–∏ —Ä–µ–∫—É—Ä—Å–∏–∏ üôÇ

```
function createElement(node) {
  if (typeof node === ‚Äòstring‚Äô) {
    return document.createTextNode(node);
  }
  const $el = document.createElement(node.type);
  node.children
    .map(createElement)
    .forEach($el.appendChild.bind($el));
  return $el;
}
```
–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ ¬´props¬ª –ø–æ–∫–∞ —á—Ç–æ –æ–ø—É—Å—Ç–∏–º, —á—Ç–æ–±—ã –Ω–µ —É—Å–ª–æ–∂–Ω—è—Ç—å.

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

–û–∫, —Ç–µ–ø–µ—Ä—å –º—ã –º–æ–∂–µ–º –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –Ω–∞—à –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –¥–æ–º –≤ –Ω–∞—Å—Ç–æ—è—â–∏–π,
–ø–æ—Ä–∞ –ø–æ–¥—É–º–∞—Ç—å –ø—Ä–æ —Å—Ä–∞–≤–Ω–∏–µ –Ω–∞—à–∏—Ö –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –¥–µ—Ä–µ–≤—å–µ–≤.
–ù–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∞–ª–≥–æ—Ä–∏—Ç–º, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –¥–≤–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –¥–µ—Ä–µ–≤–∞
‚Äî —Å—Ç–∞—Ä–æ–µ –∏ –Ω–æ–≤–æ–µ –∏ –¥–µ–ª–∞—Ç—å —Ç–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –Ω–∞—Å—Ç–æ—è—â–µ–º –¥–æ–º–µ.

–î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –¥–µ—Ä–µ–≤–∞ –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –∫–ª–∞—Å—Å, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∏–π —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:
* appendChild(‚Ä¶)
* removeChild(‚Ä¶)
* replaceChild(‚Ä¶)
* –ú–µ—Ç–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç ¬´–∑–∞–≥–ª—è–¥—ã–≤–∞—Ç—å –≤–Ω—É—Ç—Ä—å¬ª, –≤ —Å–ª—É—á–∞–µ –µ—Å–ª–∏ —É–∑–ª—ã –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ

–û–∫, –¥–∞–≤–∞–π—Ç–µ –Ω–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é updateElement(), –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–∏–Ω–∏–º–∞–µ—Ç 3 –ø–∞—Ä–∞–º–µ—Ç—Ä–∞: $parent, oldNode, newNode.
–ì–¥–µ $parent —ç–ª–µ–º–µ–Ω—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ DOM —É–∑–ª–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ –±–ª–æ–∫–∞. –ù–∏–∂–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ —Å–ª—É—á–∞–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É–∑–ª–æ–≤.

### –ï—Å–ª–∏ –Ω–µ—Ç oldNode

–í—Å–µ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ:

```
function updateElement($parent, newNode, oldNode) {
  if (!oldNode) {
    $parent.appendChild(
      createElement(newNode)
    );
  }
}
```

### –ï—Å–ª–∏ –Ω–µ—Ç –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ (newNode)

–¢—É—Ç –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî –µ—Å–ª–∏ –Ω–µ—Ç —É–∑–ª–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –º–µ—Å—Ç–∞, –º—ã –¥–æ–ª–∂–Ω—ã —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ DOM. –ú—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å
–ø–æ–∑–∏—Ü–∏—é —É–∑–ª–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è

```
function updateElement($parent, newNode, oldNode, index = 0) {
  if (!oldNode) {
    $parent.appendChild(
      createElement(newNode)
    );
  } else if (!newNode) {
    $parent.removeChild(
      $parent.childNodes[index]
    );
  }
}
```

### –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —É–∑–µ–ª

–ù–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç 2 —É–∑–ª–∞. –ú—ã –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ —ç—Ç–æ –º–æ–≥—É—Ç –±—ã—Ç—å –∫–∞–∫ —ç–ª–µ–º–µ–Ω—Ç—ã —Ç–∞–∫ –∏ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —É–∑–ª—ã:


```
function changed(node1, node2) {
  return typeof node1 !== typeof node2 ||
         typeof node1 === ‚Äòstring‚Äô && node1 !== node2 ||
         node1.type !== node2.type
}
```

–ò —Ç–µ–ø–µ—Ä—å, –∏–º–µ—è –∏–Ω–¥–µ–∫—Å —Ç–µ–∫—É—â–µ–≥–æ —É–∑–ª–∞ —Ä–æ–¥–∏—Ç–µ–ª—è, –º—ã –º–æ–∂–µ–º –ª–µ–≥–∫–æ –∑–∞–º–µ–Ω–∏—Ç—å –µ–≥–æ –Ω–∞ –≤–Ω–æ–≤—å —Å–æ–∑–¥–∞–Ω–Ω—ã–π —É–∑–µ–ª:

```
function updateElement($parent, newNode, oldNode, index = 0) {
  if (!oldNode) {
    $parent.appendChild(
      createElement(newNode)
    );
  } else if (!newNode) {
    $parent.removeChild(
      $parent.childNodes[index]
    );
  } else if (changed(newNode, oldNode)) {
    $parent.replaceChild(
      createElement(newNode),
      $parent.childNodes[index]
    );
  }
}
```

## –†–∞–∑–ª–∏—á–∏—è –¥–æ—á–µ—Ä–Ω–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤

–ò –ø–æ—Å–ª–µ–¥–Ω–µ–µ, –Ω–æ –Ω–µ –º–µ–Ω–µ–µ –≤–∞–∂–Ω–æ–µ ‚Äî –º—ã –¥–æ–ª–∂–Ω—ã –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ –∫–∞–∂–¥–æ–≥–æ —Ä–µ–±–µ–Ω–∫–∞ –Ω–∞ –æ–±–æ–∏—Ö —É–∑–ª–∞—Ö –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –∏—Ö
‚Äî –µ—Å–ª–∏ –µ—Å—Ç—å –æ—Ç–ª–∏—á–∏—è, —Ç–æ –≤—ã–∑–≤–∞—Ç—å updateElement(‚Ä¶) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–∑ –Ω–∏—Ö. –î–∞, —Ä–µ–∫—É—Ä—Å–∏—è —Å–Ω–æ–≤–∞.

```
function updateElement($parent, newNode, oldNode, index = 0) {
  if (!oldNode) {
    $parent.appendChild(
      createElement(newNode)
    );
  } else if (!newNode) {
    $parent.removeChild(
      $parent.childNodes[index]
    );
  } else if (changed(newNode, oldNode)) {
    $parent.replaceChild(
      createElement(newNode),
      $parent.childNodes[index]
    );
  } else if (newNode.type) {
    const newLength = newNode.children.length;
    const oldLength = oldNode.children.length;
    for (let i = 0; i < newLength || i < oldLength; i++) {
      updateElement(
        $parent.childNodes[index],
        newNode.children[i],
        oldNode.children[i],
        i
      );
    }
  }
}
```

## –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –≤–º–µ—Å—Ç–µ
–ö–∞–∫ —è –∏ –æ–±–µ—â–∞–ª < 50 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞

```
function helper(type, props, ...children) {
  return { type, props, children };
}

function createElement(node) {
  if (typeof node === 'string') {
    return document.createTextNode(node);
  }
  const $el = document.createElement(node.type);
  node.children
    .map(createElement)
    .forEach($el.appendChild.bind($el));
  return $el;
}

function changed(node1, node2) {
  return typeof node1 !== typeof node2 ||
         typeof node1 === 'string' && node1 !== node2 ||
         node1.type !== node2.type
}

function updateElement($parent, newNode, oldNode, index = 0) {
  if (!oldNode) {
    $parent.appendChild(
      createElement(newNode)
    );
  } else if (!newNode) {
    $parent.removeChild(
      $parent.childNodes[index]
    );
  } else if (changed(newNode, oldNode)) {
    $parent.replaceChild(
      createElement(newNode),
      $parent.childNodes[index]
    );
  } else if (newNode.type) {
    const newLength = newNode.children.length;
    const oldLength = oldNode.children.length;
    for (let i = 0; i < newLength || i < oldLength; i++) {
      updateElement(
        $parent.childNodes[index],
        newNode.children[i],
        oldNode.children[i],
        i
      );
    }
  }
}

// ---------------------------------------------------------------------

const a = (
  <ul>
    <li>item 1</li>
    <li>item 2</li>
  </ul>
);

const b = (
  <ul>
    <li>item 1</li>
    <li>hello!</li>
  </ul>
);

const $root = document.getElementById('root');
const $reload = document.getElementById('reload');

updateElement($root, a);
$reload.addEventListener('click', () => {
  updateElement($root, b, a);
});
```

## –í—ã–≤–æ–¥
–ü–æ–∑–¥—Ä–∞–≤–ª—è—é! –ú—ã —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ.
–ú—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é Virtual DOM. –ò —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.
–Ø –Ω–∞–¥–µ—é—Å—å, —á—Ç–æ –ø—Ä–æ—á–∏—Ç–∞–≤ —ç—Ç—É —Å—Ç–∞—Ç—å—é, –≤—ã –ø–æ–Ω—è–ª–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ —Ç–æ, –∫–∞–∫ Virtual DOM –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º.

–û–¥–Ω–∞–∫–æ, –µ—Å—Ç—å –≤–µ—â–∏, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏:

* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –∏ –∑–∞–º–µ–Ω–∞
* –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–∞—à–∏—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
* –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã—Ö React
* –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Å—ã–ª–æ–∫ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º —É–∑–ª—ã
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Virtual DOM —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –º—É—Ç–∏—Ä—É—é—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π –¥–æ–º ‚Äî —Ç–∞–∫–∏–µ, –∫–∞–∫ jQuery –∏ –µ–µ –ø–ª–∞–≥–∏–Ω—ã.
* –ò –º–Ω–æ–≥–æ –¥—Ä—É–≥–æ–µ‚Ä¶

–í—Ç–æ—Ä–∞—è —Å—Ç–∞—Ç—å—è –æ —Ä–∞–±–æ—Ç–µ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ –∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ Virtual DOM [–∑–¥–µ—Å—å](https://medium.com/@deathmood/write-your-virtual-dom-2-props-events-a957608f5c76).

- - - -

*–ß–∏—Ç–∞–π—Ç–µ –Ω–∞—Å –Ω–∞ [–ú–µ–¥–∏—É–º–µ](https://medium.com/devschacht), –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç—å—Ç–µ –Ω–∞ [–ì–∏—Ç—Ö–∞–±–µ](https://github.com/devSchacht), –æ–±—â–∞–π—Ç–µ—Å—å –≤ [–≥—Ä—É–ø–ø–µ –¢–µ–ª–µ–≥—Ä–∞–º–∞](https://t.me/devSchacht), —Å–ª–µ–¥–∏—Ç–µ –≤ [–¢–≤–∏—Ç—Ç–µ—Ä–µ](https://twitter.com/DevSchacht) –∏ [–∫–∞–Ω–∞–ª–µ –¢–µ–ª–µ–≥—Ä–∞–º–∞](https://t.me/devSchachtChannel), —Ä–µ–∫–æ–º–µ–Ω–¥—É–π—Ç–µ –≤ [VK](https://vk.com/devschacht) –∏ [Facebook](https://www.facebook.com/devSchacht). –°–∫–æ—Ä–æ –ø–æ–¥—ä–µ–¥–µ—Ç –ø–æ–¥–∫–∞—Å—Ç, –Ω–µ —Ç–µ—Ä—è–π—Ç–µ—Å—å.*
